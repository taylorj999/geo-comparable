mapEngine.prototype.renderTestMap = function renderTestMap() {
	var self=this;
	return new Promise((resolve, reject) => {
		var mapn = Promise2.denodeify(mapnikify);
		mapn(testgeojson,false)
    		.then(function(xml) {
    			    var map = new mapnik.Map(512,512,'+init=epsg:3857');
    			    return self.fromStringPromise(map,xml)
    			  }, function(err) { reject(err); })
    		.then(function(newMap) {
    			newMap.zoomAll();
    			var image = new mapnik.Image(newMap.width,newMap.height);
    			newMap.render(image,{},function(err, image) {
    				if (err) reject(err);
    				var buffer = image.encodeSync('png');
    				resolve(buffer);
      			    });
    		    }, function(err) { reject(err); })
    		.catch(function(err) {
    			reject(err);
    		});
    	});
};

mapEngine.prototype.renderTestMap2 = function renderTestMap2() {
	var self=this;
	let testResultSet = [{"shape":{"type": "MultiPolygon", "coordinates": [[[[-82.6799875515233, 35.5079353042139], [-82.6789835880171, 35.5078770583225], [-82.67897251461, 35.5078773940348], [-82.6789048277592, 35.507879447322], [-82.6762246783876, 35.5077736101521], [-82.6760963196886, 35.5077686314081], [-82.6761562095959, 35.5079628203921], [-82.6761584096672, 35.5079699877543], [-82.676162385479, 35.5079933784699], [-82.6760274183666, 35.5079944401951], [-82.6747931927617, 35.5080041409468], [-82.6747237182841, 35.5080062460301], [-82.6740785309111, 35.5076260100454], [-82.6756304865968, 35.506318809432], [-82.6754456404687, 35.5055414892857], [-82.6752559877151, 35.5047439411307], [-82.6764424853214, 35.5050042820592], [-82.6779345190994, 35.5053478702273], [-82.6784102067272, 35.5054700257876], [-82.6786445168806, 35.505260233012], [-82.6790427255709, 35.5052778951718], [-82.6795659244997, 35.5056453523578], [-82.679815504591, 35.5057126808928], [-82.6798903123763, 35.5057283926009], [-82.6800263251744, 35.5057569582473], [-82.6801734151329, 35.5057656966067], [-82.6801726669826, 35.5057756433108], [-82.6801772605741, 35.5058768489712], [-82.6801965497131, 35.5059753980652], [-82.6802279001137, 35.5060724859028], [-82.6802738964793, 35.5061658219567], [-82.6803305101964, 35.5062555321379], [-82.6804002749788, 35.5063382357412], [-82.6811176058805, 35.5071833765419], [-82.6816986013256, 35.5077915251735], [-82.6817018663322, 35.5077945428097], [-82.6819407252071, 35.5080149654198], [-82.6799904957442, 35.5079356241669], [-82.6799875515233, 35.5079353042139]]], [[[-82.6835247946335, 35.5079745055404], [-82.6835113116631, 35.5079743670777], [-82.683464913755, 35.5079757766944], [-82.6834151247848, 35.5079767377512], [-82.6833646282087, 35.50797717004], [-82.6833147905307, 35.5079770245969], [-82.6832649166229, 35.5079763499705], [-82.6832150289438, 35.5079751030579], [-82.683165082801, 35.5079727699253], [-82.6831151454079, 35.5079704277729], [-82.6830658522457, 35.5079675208126], [-82.6830158528389, 35.5079640812987], [-82.6829897052827, 35.5079665380339], [-82.6829628304836, 35.5079678989169], [-82.682936575253, 35.5079681517686], [-82.6829102632505, 35.5079672884194], [-82.6828839410387, 35.5079658976072], [-82.6828575557921, 35.5079633870412], [-82.6828311330236, 35.5079597809005], [-82.682805350142, 35.5079556150906], [-82.6827795292313, 35.5079503424928], [-82.6827543163805, 35.5079439434993], [-82.6827080791778, 35.5079343372049], [-82.6826624734096, 35.5079236150234], [-82.6826174392626, 35.5079106608523], [-82.6825730153911, 35.5078965951806], [-82.6825292112256, 35.5078808525254], [-82.6824866546835, 35.507863416328], [-82.6824447185303, 35.5078443181002], [-82.6824040551694, 35.5078240807847], [-82.6823646978422, 35.5078026971356], [-82.6823136878238, 35.5077784330934], [-82.682308065833, 35.5077761332908], [-82.6821088651639, 35.5076820130728], [-82.6820921746185, 35.5076704045744], [-82.6820728335731, 35.5076599719567], [-82.6820535520005, 35.5076506479633], [-82.682033024447, 35.5076435576831], [-82.6820111985569, 35.5076376147304], [-82.6819894738245, 35.5076338671099], [-82.6819664535747, 35.5076312617397], [-82.6819435346494, 35.5076308554393], [-82.6819220595595, 35.5076326087228], [-82.681901173237, 35.5076352649236], [-82.6818748732136, 35.5076318382632], [-82.6818476650395, 35.5076260523467], [-82.6818203588799, 35.5076180734871], [-82.6817956919445, 35.5076089053625], [-82.6817709269136, 35.5075975418039], [-82.6817474560007, 35.5075850385266], [-82.6817252322158, 35.5075702927637], [-82.681704355183, 35.5075554998986], [-82.6816847225708, 35.5075384721175], [-82.6816677325149, 35.5075202612143], [-82.6811251967599, 35.5068758124795], [-82.680598621993, 35.5062562076872], [-82.6805414110609, 35.5061830399568], [-82.680493421951, 35.506105184463], [-82.6804560487887, 35.5060237068685], [-82.6804279877925, 35.5059397359465], [-82.6804106440251, 35.5058543432624], [-82.6804054532011, 35.5057696799371], [-82.6805616066642, 35.5057968817833], [-82.6807740677039, 35.5058179736888], [-82.6815024322801, 35.5059566813634], [-82.6820540529723, 35.5061129625695], [-82.682063999439, 35.5066347036451], [-82.6824178996725, 35.5065369355665], [-82.6825536778245, 35.5065603464208], [-82.6826761153253, 35.5066755967388], [-82.6829600681785, 35.5070249737111], [-82.6835007227046, 35.5071637246782], [-82.6834994123733, 35.507183731029], [-82.6834995271657, 35.5073049006923], [-82.6835753628829, 35.5077376349884], [-82.6835776554162, 35.5077409765474], [-82.6835842731795, 35.5077568395057], [-82.6835904259574, 35.5077737197107], [-82.6835952274197, 35.5077906471731], [-82.6835993733715, 35.5078075882949], [-82.6836035250851, 35.5078250931917], [-82.6836056533727, 35.5078420918168], [-82.6836077947572, 35.5078596477558], [-82.6836092717698, 35.5078772238619], [-82.6836093693555, 35.5078942953581], [-82.6836088258215, 35.5079119327981], [-82.6836059619797, 35.5079230292315], [-82.6836010326624, 35.5079330966451], [-82.6835940838103, 35.5079432141325], [-82.6835857193484, 35.5079517276567], [-82.6835759471225, 35.5079591797188], [-82.683564121497, 35.5079655998978], [-82.6835515445224, 35.5079703934539], [-82.6835388892065, 35.5079735287287], [-82.6835247946335, 35.5079745055404]]]]}},
	   {"shape":{"type": "Polygon", "coordinates": [[[-82.6824973818042, 35.5021768041805], [-82.6826308525033, 35.5019935507388], [-82.6830408659963, 35.5022792628543], [-82.6819404461268, 35.5039356474665], [-82.6814389806158, 35.5035952943346], [-82.6814746552508, 35.5035352280587], [-82.6815300051609, 35.503448731671], [-82.6815867922695, 35.5033643875599], [-82.6816463216823, 35.5032810644079], [-82.6817099358892, 35.5031987239732], [-82.6817749980066, 35.5031185367275], [-82.6818427992514, 35.5030393680289], [-82.6819130930427, 35.502955716858], [-82.6819806461962, 35.5028710533404], [-82.6820494928432, 35.5027852413435], [-82.6821157002904, 35.5027006185731], [-82.6821817982621, 35.5026137881977], [-82.6822466085596, 35.5025281060415], [-82.6823113261402, 35.5024402157731], [-82.6823747407591, 35.5023534729432], [-82.6824367596136, 35.5022656644944], [-82.6824973818042, 35.5021768041805]]]}}]
	return new Promise((resolve,reject) => {
		customMapnikify(testResultSet)
		    .then(function(xml) {
		    	var map = new mapnik.Map(512,512,'+init=epsg:3857');
		    	return self.fromStringPromise(map,xml);
		    })
		    .then(function(newMap) {
		    	newMap.zoomAll();
		    	var vect = new mapnik.VectorTile(0,0,0,{tile_size: newMap.width});
		    	console.log(newMap.toXML());
		    	newMap.render(vect,{},function(err, theVect) {
    				if (err) { reject(err); }
    				else {
    					console.log(theVect.names());
    					theVect.toGeoJSON('__all__',(err,geojson) => { console.log(geojson); });
    					//var buffer = image.encodeSync('png');
    					var buffer = theVect.getDataSync();
    					resolve(buffer);
    				}
   				});
		    })
		    .catch(function(err) {
    			reject(err);
    		});
	});
}

mapEngine.prototype.renderTestMap3 = function renderTestMap3() {
	var self=this;
	let testStylesheet = '<?xml version="1.0" encoding="utf-8"?>' +
'<Map srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over" background-color="steelblue">'+
'    <Style name="style">'+
'        <Rule>'+
'            <PolygonSymbolizer fill="white" clip="false"/>'+
'        </Rule>'+
'    </Style>'+
'<Style name="Polygon">'+
'<Rule>'+
'  <LineSymbolizer stroke="black" stroke-width="2" />'+
'  <PolygonSymbolizer fill="[fill]" />'+
'  <TextSymbolizer face-name="Arial Regular" placement-type="simple" placement="X" allow-overlap="true">[name]</TextSymbolizer>'+
'</Rule>'+
'</Style>' +
'<Style name="MultiPolygon">'+
'<Rule>'+
'  <LineSymbolizer stroke="black" stroke-width="2" />'+
'  <PolygonSymbolizer fill="[fill]" />'+
'  <TextSymbolizer face-name="Arial Regular" placement-type="simple" placement="X" allow-overlap="true">[name]</TextSymbolizer>'+
'</Rule>'+
'</Style>'+
'</Map>';
	let testResultSet = [{"shape":'{"type": "MultiPolygon", "coordinates": [[[[-82.6799875515233, 35.5079353042139], [-82.6789835880171, 35.5078770583225], [-82.67897251461, 35.5078773940348], [-82.6789048277592, 35.507879447322], [-82.6762246783876, 35.5077736101521], [-82.6760963196886, 35.5077686314081], [-82.6761562095959, 35.5079628203921], [-82.6761584096672, 35.5079699877543], [-82.676162385479, 35.5079933784699], [-82.6760274183666, 35.5079944401951], [-82.6747931927617, 35.5080041409468], [-82.6747237182841, 35.5080062460301], [-82.6740785309111, 35.5076260100454], [-82.6756304865968, 35.506318809432], [-82.6754456404687, 35.5055414892857], [-82.6752559877151, 35.5047439411307], [-82.6764424853214, 35.5050042820592], [-82.6779345190994, 35.5053478702273], [-82.6784102067272, 35.5054700257876], [-82.6786445168806, 35.505260233012], [-82.6790427255709, 35.5052778951718], [-82.6795659244997, 35.5056453523578], [-82.679815504591, 35.5057126808928], [-82.6798903123763, 35.5057283926009], [-82.6800263251744, 35.5057569582473], [-82.6801734151329, 35.5057656966067], [-82.6801726669826, 35.5057756433108], [-82.6801772605741, 35.5058768489712], [-82.6801965497131, 35.5059753980652], [-82.6802279001137, 35.5060724859028], [-82.6802738964793, 35.5061658219567], [-82.6803305101964, 35.5062555321379], [-82.6804002749788, 35.5063382357412], [-82.6811176058805, 35.5071833765419], [-82.6816986013256, 35.5077915251735], [-82.6817018663322, 35.5077945428097], [-82.6819407252071, 35.5080149654198], [-82.6799904957442, 35.5079356241669], [-82.6799875515233, 35.5079353042139]]], [[[-82.6835247946335, 35.5079745055404], [-82.6835113116631, 35.5079743670777], [-82.683464913755, 35.5079757766944], [-82.6834151247848, 35.5079767377512], [-82.6833646282087, 35.50797717004], [-82.6833147905307, 35.5079770245969], [-82.6832649166229, 35.5079763499705], [-82.6832150289438, 35.5079751030579], [-82.683165082801, 35.5079727699253], [-82.6831151454079, 35.5079704277729], [-82.6830658522457, 35.5079675208126], [-82.6830158528389, 35.5079640812987], [-82.6829897052827, 35.5079665380339], [-82.6829628304836, 35.5079678989169], [-82.682936575253, 35.5079681517686], [-82.6829102632505, 35.5079672884194], [-82.6828839410387, 35.5079658976072], [-82.6828575557921, 35.5079633870412], [-82.6828311330236, 35.5079597809005], [-82.682805350142, 35.5079556150906], [-82.6827795292313, 35.5079503424928], [-82.6827543163805, 35.5079439434993], [-82.6827080791778, 35.5079343372049], [-82.6826624734096, 35.5079236150234], [-82.6826174392626, 35.5079106608523], [-82.6825730153911, 35.5078965951806], [-82.6825292112256, 35.5078808525254], [-82.6824866546835, 35.507863416328], [-82.6824447185303, 35.5078443181002], [-82.6824040551694, 35.5078240807847], [-82.6823646978422, 35.5078026971356], [-82.6823136878238, 35.5077784330934], [-82.682308065833, 35.5077761332908], [-82.6821088651639, 35.5076820130728], [-82.6820921746185, 35.5076704045744], [-82.6820728335731, 35.5076599719567], [-82.6820535520005, 35.5076506479633], [-82.682033024447, 35.5076435576831], [-82.6820111985569, 35.5076376147304], [-82.6819894738245, 35.5076338671099], [-82.6819664535747, 35.5076312617397], [-82.6819435346494, 35.5076308554393], [-82.6819220595595, 35.5076326087228], [-82.681901173237, 35.5076352649236], [-82.6818748732136, 35.5076318382632], [-82.6818476650395, 35.5076260523467], [-82.6818203588799, 35.5076180734871], [-82.6817956919445, 35.5076089053625], [-82.6817709269136, 35.5075975418039], [-82.6817474560007, 35.5075850385266], [-82.6817252322158, 35.5075702927637], [-82.681704355183, 35.5075554998986], [-82.6816847225708, 35.5075384721175], [-82.6816677325149, 35.5075202612143], [-82.6811251967599, 35.5068758124795], [-82.680598621993, 35.5062562076872], [-82.6805414110609, 35.5061830399568], [-82.680493421951, 35.506105184463], [-82.6804560487887, 35.5060237068685], [-82.6804279877925, 35.5059397359465], [-82.6804106440251, 35.5058543432624], [-82.6804054532011, 35.5057696799371], [-82.6805616066642, 35.5057968817833], [-82.6807740677039, 35.5058179736888], [-82.6815024322801, 35.5059566813634], [-82.6820540529723, 35.5061129625695], [-82.682063999439, 35.5066347036451], [-82.6824178996725, 35.5065369355665], [-82.6825536778245, 35.5065603464208], [-82.6826761153253, 35.5066755967388], [-82.6829600681785, 35.5070249737111], [-82.6835007227046, 35.5071637246782], [-82.6834994123733, 35.507183731029], [-82.6834995271657, 35.5073049006923], [-82.6835753628829, 35.5077376349884], [-82.6835776554162, 35.5077409765474], [-82.6835842731795, 35.5077568395057], [-82.6835904259574, 35.5077737197107], [-82.6835952274197, 35.5077906471731], [-82.6835993733715, 35.5078075882949], [-82.6836035250851, 35.5078250931917], [-82.6836056533727, 35.5078420918168], [-82.6836077947572, 35.5078596477558], [-82.6836092717698, 35.5078772238619], [-82.6836093693555, 35.5078942953581], [-82.6836088258215, 35.5079119327981], [-82.6836059619797, 35.5079230292315], [-82.6836010326624, 35.5079330966451], [-82.6835940838103, 35.5079432141325], [-82.6835857193484, 35.5079517276567], [-82.6835759471225, 35.5079591797188], [-82.683564121497, 35.5079655998978], [-82.6835515445224, 35.5079703934539], [-82.6835388892065, 35.5079735287287], [-82.6835247946335, 35.5079745055404]]]]}'},
		   {"shape":'{"type": "Polygon", "coordinates": [[[-82.6824973818042, 35.5021768041805], [-82.6826308525033, 35.5019935507388], [-82.6830408659963, 35.5022792628543], [-82.6819404461268, 35.5039356474665], [-82.6814389806158, 35.5035952943346], [-82.6814746552508, 35.5035352280587], [-82.6815300051609, 35.503448731671], [-82.6815867922695, 35.5033643875599], [-82.6816463216823, 35.5032810644079], [-82.6817099358892, 35.5031987239732], [-82.6817749980066, 35.5031185367275], [-82.6818427992514, 35.5030393680289], [-82.6819130930427, 35.502955716858], [-82.6819806461962, 35.5028710533404], [-82.6820494928432, 35.5027852413435], [-82.6821157002904, 35.5027006185731], [-82.6821817982621, 35.5026137881977], [-82.6822466085596, 35.5025281060415], [-82.6823113261402, 35.5024402157731], [-82.6823747407591, 35.5023534729432], [-82.6824367596136, 35.5022656644944], [-82.6824973818042, 35.5021768041805]]]}'}]
	return new Promise((resolve,reject) => {
		var map = new mapnik.Map(512,512,'+init=epsg:3857');
        map.extent = [-20037508.34, -20037508.34, 20037508.34, 20037508.34];
        self.fromStringPromise(map,testStylesheet)
            .then(function(newMap) {
            	newMap.zoomAll();
            	var vect = new mapnik.VectorTile(0,0,0);
            	for (var i=0; i<testResultSet.length; i++) {
        			var curShape = null; 
        			if (typeof testResultSet[i].shape === 'string' || testResultSet[i].shape instanceof String) {
        				curShape = JSON.parse(testResultSet[i].shape);
        			} else {
        				curShape = testResultSet[i].shape;
        			}
        			var gj = normalize(curShape);
            		vect.addGeoJSON(JSON.stringify(gj),'layer'+i,{process_all_rings:true});
            	}
		    	var surface = new mapnik.CairoSurface('svg',vect.tileSize,vect.tileSize);
		    	console.log('A');
		    	console.log(vect.names());
		    	vect.toGeoJSON('__all__',(err,geojson) => { console.log(geojson); });
    			vect.render(newMap,surface,{renderer:'svg'},function(err, theSurface) {
    				if (err) reject(err);
    				//var buffer = image.encodeSync('png');
    				var buffer = theSurface.getDataSync();
    				resolve(buffer);
      			    });
            }, function(err) { reject(err); })
            .catch(function(err) {
    			reject(err);
    		});
	});
};

mapEngine.prototype.renderTestMap4 = function renderTestMap4() {
	var self=this;
	let testResultSet = [{"shape":{"type": "MultiPolygon", "coordinates": [[[[-82.6799875515233, 35.5079353042139], [-82.6789835880171, 35.5078770583225], [-82.67897251461, 35.5078773940348], [-82.6789048277592, 35.507879447322], [-82.6762246783876, 35.5077736101521], [-82.6760963196886, 35.5077686314081], [-82.6761562095959, 35.5079628203921], [-82.6761584096672, 35.5079699877543], [-82.676162385479, 35.5079933784699], [-82.6760274183666, 35.5079944401951], [-82.6747931927617, 35.5080041409468], [-82.6747237182841, 35.5080062460301], [-82.6740785309111, 35.5076260100454], [-82.6756304865968, 35.506318809432], [-82.6754456404687, 35.5055414892857], [-82.6752559877151, 35.5047439411307], [-82.6764424853214, 35.5050042820592], [-82.6779345190994, 35.5053478702273], [-82.6784102067272, 35.5054700257876], [-82.6786445168806, 35.505260233012], [-82.6790427255709, 35.5052778951718], [-82.6795659244997, 35.5056453523578], [-82.679815504591, 35.5057126808928], [-82.6798903123763, 35.5057283926009], [-82.6800263251744, 35.5057569582473], [-82.6801734151329, 35.5057656966067], [-82.6801726669826, 35.5057756433108], [-82.6801772605741, 35.5058768489712], [-82.6801965497131, 35.5059753980652], [-82.6802279001137, 35.5060724859028], [-82.6802738964793, 35.5061658219567], [-82.6803305101964, 35.5062555321379], [-82.6804002749788, 35.5063382357412], [-82.6811176058805, 35.5071833765419], [-82.6816986013256, 35.5077915251735], [-82.6817018663322, 35.5077945428097], [-82.6819407252071, 35.5080149654198], [-82.6799904957442, 35.5079356241669], [-82.6799875515233, 35.5079353042139]]], [[[-82.6835247946335, 35.5079745055404], [-82.6835113116631, 35.5079743670777], [-82.683464913755, 35.5079757766944], [-82.6834151247848, 35.5079767377512], [-82.6833646282087, 35.50797717004], [-82.6833147905307, 35.5079770245969], [-82.6832649166229, 35.5079763499705], [-82.6832150289438, 35.5079751030579], [-82.683165082801, 35.5079727699253], [-82.6831151454079, 35.5079704277729], [-82.6830658522457, 35.5079675208126], [-82.6830158528389, 35.5079640812987], [-82.6829897052827, 35.5079665380339], [-82.6829628304836, 35.5079678989169], [-82.682936575253, 35.5079681517686], [-82.6829102632505, 35.5079672884194], [-82.6828839410387, 35.5079658976072], [-82.6828575557921, 35.5079633870412], [-82.6828311330236, 35.5079597809005], [-82.682805350142, 35.5079556150906], [-82.6827795292313, 35.5079503424928], [-82.6827543163805, 35.5079439434993], [-82.6827080791778, 35.5079343372049], [-82.6826624734096, 35.5079236150234], [-82.6826174392626, 35.5079106608523], [-82.6825730153911, 35.5078965951806], [-82.6825292112256, 35.5078808525254], [-82.6824866546835, 35.507863416328], [-82.6824447185303, 35.5078443181002], [-82.6824040551694, 35.5078240807847], [-82.6823646978422, 35.5078026971356], [-82.6823136878238, 35.5077784330934], [-82.682308065833, 35.5077761332908], [-82.6821088651639, 35.5076820130728], [-82.6820921746185, 35.5076704045744], [-82.6820728335731, 35.5076599719567], [-82.6820535520005, 35.5076506479633], [-82.682033024447, 35.5076435576831], [-82.6820111985569, 35.5076376147304], [-82.6819894738245, 35.5076338671099], [-82.6819664535747, 35.5076312617397], [-82.6819435346494, 35.5076308554393], [-82.6819220595595, 35.5076326087228], [-82.681901173237, 35.5076352649236], [-82.6818748732136, 35.5076318382632], [-82.6818476650395, 35.5076260523467], [-82.6818203588799, 35.5076180734871], [-82.6817956919445, 35.5076089053625], [-82.6817709269136, 35.5075975418039], [-82.6817474560007, 35.5075850385266], [-82.6817252322158, 35.5075702927637], [-82.681704355183, 35.5075554998986], [-82.6816847225708, 35.5075384721175], [-82.6816677325149, 35.5075202612143], [-82.6811251967599, 35.5068758124795], [-82.680598621993, 35.5062562076872], [-82.6805414110609, 35.5061830399568], [-82.680493421951, 35.506105184463], [-82.6804560487887, 35.5060237068685], [-82.6804279877925, 35.5059397359465], [-82.6804106440251, 35.5058543432624], [-82.6804054532011, 35.5057696799371], [-82.6805616066642, 35.5057968817833], [-82.6807740677039, 35.5058179736888], [-82.6815024322801, 35.5059566813634], [-82.6820540529723, 35.5061129625695], [-82.682063999439, 35.5066347036451], [-82.6824178996725, 35.5065369355665], [-82.6825536778245, 35.5065603464208], [-82.6826761153253, 35.5066755967388], [-82.6829600681785, 35.5070249737111], [-82.6835007227046, 35.5071637246782], [-82.6834994123733, 35.507183731029], [-82.6834995271657, 35.5073049006923], [-82.6835753628829, 35.5077376349884], [-82.6835776554162, 35.5077409765474], [-82.6835842731795, 35.5077568395057], [-82.6835904259574, 35.5077737197107], [-82.6835952274197, 35.5077906471731], [-82.6835993733715, 35.5078075882949], [-82.6836035250851, 35.5078250931917], [-82.6836056533727, 35.5078420918168], [-82.6836077947572, 35.5078596477558], [-82.6836092717698, 35.5078772238619], [-82.6836093693555, 35.5078942953581], [-82.6836088258215, 35.5079119327981], [-82.6836059619797, 35.5079230292315], [-82.6836010326624, 35.5079330966451], [-82.6835940838103, 35.5079432141325], [-82.6835857193484, 35.5079517276567], [-82.6835759471225, 35.5079591797188], [-82.683564121497, 35.5079655998978], [-82.6835515445224, 35.5079703934539], [-82.6835388892065, 35.5079735287287], [-82.6835247946335, 35.5079745055404]]]]}},
	   {"shape":{"type": "Polygon", "coordinates": [[[-82.6824973818042, 35.5021768041805], [-82.6826308525033, 35.5019935507388], [-82.6830408659963, 35.5022792628543], [-82.6819404461268, 35.5039356474665], [-82.6814389806158, 35.5035952943346], [-82.6814746552508, 35.5035352280587], [-82.6815300051609, 35.503448731671], [-82.6815867922695, 35.5033643875599], [-82.6816463216823, 35.5032810644079], [-82.6817099358892, 35.5031987239732], [-82.6817749980066, 35.5031185367275], [-82.6818427992514, 35.5030393680289], [-82.6819130930427, 35.502955716858], [-82.6819806461962, 35.5028710533404], [-82.6820494928432, 35.5027852413435], [-82.6821157002904, 35.5027006185731], [-82.6821817982621, 35.5026137881977], [-82.6822466085596, 35.5025281060415], [-82.6823113261402, 35.5024402157731], [-82.6823747407591, 35.5023534729432], [-82.6824367596136, 35.5022656644944], [-82.6824973818042, 35.5021768041805]]]}}]
	return new Promise((resolve,reject) => {
		customMapnikify(testResultSet)
		    .then(function(xml) {
		    	var map = new mapnik.Map(512,512,'+init=epsg:3857');
		    	return self.fromStringPromise(map,xml);
		    })
		    .then(function(newMap) {
		    	newMap.zoomAll();
		    	var surface = new mapnik.CairoSurface('svg',512,512);
		    	console.log(newMap.toXML());
		    	newMap.render(surface,{},function(err, surface) {
    				if (err) { reject(err); }
    				else {
    					var buffer = surface.getDataSync();
    					resolve(buffer);
    				}
   				});
		    })
		    .catch(function(err) {
    			reject(err);
    		});
	});
};
